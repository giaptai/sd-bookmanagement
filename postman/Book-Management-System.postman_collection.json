{
	"info": {
		"_postman_id": "c75f80eb-63a4-4130-8962-5e22f625f2cc",
		"name": "Book Management System - Full CRUD Flow",
		"description": "Complete Postman collection demonstrating:\n- Register → Login (as ADMIN and STUDENT)\n- Full CRUD flow for both roles\n- Role-based access control testing",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "1. Setup - Register Users",
			"description": "Register ADMIN and STUDENT users for testing",
			"item": [
				{
					"name": "Register ADMIN",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"User registered successfully\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.eql(\"User registered successfully\");",
									"    pm.expect(jsonData.user.role).to.eql(\"ADMIN\");",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstname\": \"Alice\",\n  \"lastname\": \"Nguyen\",\n  \"email\": \"alice.admin@example.com\",\n  \"phone\": \"+84987654321\",\n  \"nationality\": \"Vietnamese\",\n  \"birthday\": \"1995-03-20\",\n  \"role\": \"ADMIN\",\n  \"password\": \"Admin1234\"\n}"
						},
						"url": {
							"raw": "http://localhost:3001/api/auth/register",
							"protocol": "http",
							"host": ["localhost"],
							"port": "3001",
							"path": ["api", "auth", "register"]
						},
						"description": "Register an ADMIN user for testing full CRUD operations"
					},
					"response": []
				},
				{
					"name": "Register STUDENT",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"User registered successfully\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.eql(\"User registered successfully\");",
									"    pm.expect(jsonData.user.role).to.eql(\"STUDENT\");",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstname\": \"John\",\n  \"lastname\": \"Doe\",\n  \"email\": \"john.student@example.com\",\n  \"phone\": \"+84901234567\",\n  \"nationality\": \"Vietnamese\",\n  \"birthday\": \"2000-05-15\",\n  \"role\": \"STUDENT\",\n  \"password\": \"Student123\"\n}"
						},
						"url": {
							"raw": "http://localhost:3001/api/auth/register",
							"protocol": "http",
							"host": ["localhost"],
							"port": "3001",
							"path": ["api", "auth", "register"]
						},
						"description": "Register a STUDENT user for testing read-only access"
					},
					"response": []
				}
			]
		},
		{
			"name": "2. ADMIN Flow - Full CRUD",
			"description": "Complete CRUD flow as ADMIN user",
			"item": [
				{
					"name": "Login as ADMIN",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Login successful\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.eql(\"Login successful\");",
									"    pm.expect(jsonData.accessToken).to.not.be.undefined;",
									"    ",
									"    // Save token to collection variable",
									"    pm.collectionVariables.set(\"admin_token\", jsonData.accessToken);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"alice.admin@example.com\",\n  \"password\": \"Admin1234\"\n}"
						},
						"url": {
							"raw": "http://localhost:3001/api/auth/login",
							"protocol": "http",
							"host": ["localhost"],
							"port": "3001",
							"path": ["api", "auth", "login"]
						},
						"description": "Login as ADMIN and save JWT token"
					},
					"response": []
				},
				{
					"name": "Create Book (ADMIN)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Book created successfully\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.title).to.eql(\"Clean Code\");",
									"    pm.expect(jsonData._id).to.not.be.undefined;",
									"    ",
									"    // Save book ID for later use",
									"    pm.collectionVariables.set(\"book_id\", jsonData._id);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{admin_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"Clean Code\",\n  \"author\": \"Robert C. Martin\",\n  \"summary\": \"A handbook of agile software craftsmanship, focusing on writing clean and maintainable code.\",\n  \"publicationYear\": 2008\n}"
						},
						"url": {
							"raw": "http://localhost:3001/api/books",
							"protocol": "http",
							"host": ["localhost"],
							"port": "3001",
							"path": ["api", "books"]
						},
						"description": "ADMIN creates a new book (should succeed)"
					},
					"response": []
				},
				{
					"name": "Get All Books (ADMIN)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has pagination\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.be.an('array');",
									"    pm.expect(jsonData.meta).to.not.be.undefined;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{admin_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:3001/api/books?page=1&limit=10",
							"protocol": "http",
							"host": ["localhost"],
							"port": "3001",
							"path": ["api", "books"],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "10"
								}
							]
						},
						"description": "ADMIN gets all books with pagination"
					},
					"response": []
				},
				{
					"name": "Get Book by ID (ADMIN)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Book details returned\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData._id).to.not.be.undefined;",
									"    pm.expect(jsonData.title).to.not.be.undefined;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{admin_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:3001/api/books/{{book_id}}",
							"protocol": "http",
							"host": ["localhost"],
							"port": "3001",
							"path": ["api", "books", "{{book_id}}"]
						},
						"description": "ADMIN gets a specific book by ID"
					},
					"response": []
				},
				{
					"name": "Update Book (ADMIN)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Book updated successfully\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.summary).to.include(\"Updated edition\");",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{admin_token}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"summary\": \"Updated edition with new chapters on modern software development practices.\"\n}"
						},
						"url": {
							"raw": "http://localhost:3001/api/books/{{book_id}}",
							"protocol": "http",
							"host": ["localhost"],
							"port": "3001",
							"path": ["api", "books", "{{book_id}}"]
						},
						"description": "ADMIN updates a book (should succeed)"
					},
					"response": []
				},
				{
					"name": "Delete Book (ADMIN)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Book deleted successfully\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.eql(\"Book deleted successfully\");",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{admin_token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "http://localhost:3001/api/books/{{book_id}}",
							"protocol": "http",
							"host": ["localhost"],
							"port": "3001",
							"path": ["api", "books", "{{book_id}}"]
						},
						"description": "ADMIN deletes a book (should succeed)"
					},
					"response": []
				}
			]
		},
		{
			"name": "3. STUDENT Flow - Read Only + Access Control",
			"description": "STUDENT can only read, CRUD operations should fail with 403",
			"item": [
				{
					"name": "Login as STUDENT",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Login successful\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.eql(\"Login successful\");",
									"    pm.expect(jsonData.accessToken).to.not.be.undefined;",
									"    ",
									"    // Save token to collection variable",
									"    pm.collectionVariables.set(\"student_token\", jsonData.accessToken);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"john.student@example.com\",\n  \"password\": \"Student123\"\n}"
						},
						"url": {
							"raw": "http://localhost:3001/api/auth/login",
							"protocol": "http",
							"host": ["localhost"],
							"port": "3001",
							"path": ["api", "auth", "login"]
						},
						"description": "Login as STUDENT and save JWT token"
					},
					"response": []
				},
				{
					"name": "Get All Books (STUDENT)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"STUDENT can read books\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.be.an('array');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{student_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:3001/api/books",
							"protocol": "http",
							"host": ["localhost"],
							"port": "3001",
							"path": ["api", "books"]
						},
						"description": "STUDENT can read all books (should succeed)"
					},
					"response": []
				},
				{
					"name": "Get Book by ID (STUDENT)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"STUDENT can read book details\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData._id).to.not.be.undefined;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{student_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:3001/api/books/{{book_id}}",
							"protocol": "http",
							"host": ["localhost"],
							"port": "3001",
							"path": ["api", "books", "{{book_id}}"]
						},
						"description": "STUDENT can read book by ID (should succeed)"
					},
					"response": []
				},
				{
					"name": "Try Create Book (STUDENT) ❌",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 403 Forbidden\", function () {",
									"    pm.response.to.have.status(403);",
									"});",
									"",
									"pm.test(\"STUDENT cannot create books\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.include(\"permission\");",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{student_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"Unauthorized Book\",\n  \"author\": \"Student Hacker\",\n  \"summary\": \"This should fail with 403\",\n  \"publicationYear\": 2024\n}"
						},
						"url": {
							"raw": "http://localhost:3001/api/books",
							"protocol": "http",
							"host": ["localhost"],
							"port": "3001",
							"path": ["api", "books"]
						},
						"description": "STUDENT tries to create a book (should fail with 403)"
					},
					"response": []
				},
				{
					"name": "Try Update Book (STUDENT) ❌",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 403 Forbidden\", function () {",
									"    pm.response.to.have.status(403);",
									"});",
									"",
									"pm.test(\"STUDENT cannot update books\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.include(\"permission\");",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{student_token}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"summary\": \"Hacked summary\"\n}"
						},
						"url": {
							"raw": "http://localhost:3001/api/books/{{book_id}}",
							"protocol": "http",
							"host": ["localhost"],
							"port": "3001",
							"path": ["api", "books", "{{book_id}}"]
						},
						"description": "STUDENT tries to update a book (should fail with 403)"
					},
					"response": []
				},
				{
					"name": "Try Delete Book (STUDENT) ❌",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 403 Forbidden\", function () {",
									"    pm.response.to.have.status(403);",
									"});",
									"",
									"pm.test(\"STUDENT cannot delete books\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.include(\"permission\");",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{student_token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "http://localhost:3001/api/books/{{book_id}}",
							"protocol": "http",
							"host": ["localhost"],
							"port": "3001",
							"path": ["api", "books", "{{book_id}}"]
						},
						"description": "STUDENT tries to delete a book (should fail with 403)"
					},
					"response": []
				}
			]
		}
	],
	"variable": [
		{
			"key": "admin_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "student_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "book_id",
			"value": "",
			"type": "string"
		}
	]
}
